# LTBox

[English](../README.md)

[![License: CC BY-NC-SA 4.0][cc-by-nc-sa-shield]][cc-by-nc-sa]

## ⚠️ 중요: 면책 조항

**이 프로젝트는 오직 교육적인 목적으로만 제공됩니다.**

기기의 펌웨어를 수정하는 행위는 기기 벽돌 현상, 데이터 손실, 보증 무효화 등을 포함한 심각한 위험을 수반합니다. 제작자는 이 스크립트를 사용하여 발생하는 **본인 또는 타인 기기의 손상이나 결과에 대해 어떠한 책임도 지지 않습니다.**

**모든 결과에 대한 책임은 전적으로 사용자 본인에게 있습니다. 반드시 위험을 감수하고 사용하세요.**

---

## 1. 핵심 취약점 및 개요

이 툴킷은 특정 레노버 Android 태블릿에서 발견된 보안 취약점을 이용합니다. 해당 기기들의 펌웨어는 공개적으로 사용 가능한 **AOSP (Android Open Source Project) 테스트 키**로 서명되어 있습니다.

이 취약점으로 인해 기기의 부트로더는 **잠긴 상태**에서도 해당 테스트 키로 서명된 모든 이미지를 신뢰하고 부팅하게 됩니다.

LTBox는 이러한 결함을 활용하여 부트로더가 잠긴 상태에서도 기기에 고급 수정 작업을 수행할 수 있도록 돕는 올인원 자동화 스크립트 모음입니다.

### 적용 대상 모델

* Lenovo Legion Y700 2세대, 3세대, 4세대 (Legion Tab)
* Lenovo Yoga Pad Pro AI (Yoga Tab Plus AI)
* Lenovo Xiaoxin Pad Pro GT (Yoga Tab 11.1 AI)
* *...그 외 2023년 이후 출시된 퀄컴 칩셋 탑재 레노버 기기도 취약점을 보유하고 있을 수 있습니다.*

## 2. 사용 방법

이 툴킷은 완전 자동화를 목표로 설계되었습니다.

1.  **다운로드 및 압축 해제:** 최신 릴리스를 다운로드하고 폴더에 압축을 풉니다 (경로에 공백이나 한글을 포함한 비 ASCII 문자가 없어야 합니다).
2.  **스크립트 실행:** **`start.bat`** 파일을 더블 클릭합니다.
    * *첫 실행 시 필요한 의존성 파일들이 자동으로 설치됩니다.*
3.  **작업 선택:** 화면의 메뉴를 따라 원하는 작업을 선택합니다.

## 3. 메뉴 설명

### 3.1 메인 메뉴

**`1. 중국(PRC)/글로벌(ROW) 기기에 펌웨어 설치 (데이터 초기화)`**
올인원 자동화 작업입니다. 모든 단계(변환, XML 준비, 덤프, 패치, ARB 확인, 플래싱)를 수행하며 **사용자 데이터를 모두 삭제(초기화)**합니다. (설정된 지역에 따라 메뉴명이 바뀝니다.)

**`2. 중국(PRC)/글로벌(ROW) 기기에 펌웨어 설치 (데이터 유지)`**
1번과 동일하지만, **사용자 데이터를 보존**하도록 XML 스크립트를 수정하여 진행합니다 (`userdata` 및 `metadata` 파티션 제외 처리).

**`3. OTA 이후 구출`**
변환된 펌웨어를 설치한 기기에서 실수로 전체 OTA 업데이트를 진행하여 부팅 문제가 발생했을 때, 기기에서 필수 파티션만을 덤프하고 패치하여 복구를 시도합니다.

**`4. OTA 비활성화`**
ADB 모드로 기기에 연결하여 시스템 업데이트 패키지를 비활성화함으로써 자동 업데이트를 방지합니다.

**`5. 기기 루팅`**
루팅 선택 메뉴를 엽니다:
* **LKM 모드:** `init_boot.img`와 `vbmeta.img`를 패치합니다 (최신 커널 권장). Magisk, KernelSU Next 및 SukiSU를 지원합니다.
* **GKI 모드:** 커널을 [GKI_KernelSU_SUSFS](https://github.com/WildKernels/GKI_KernelSU_SUSFS)로 교체하여 `boot.img`를 패치합니다.

**`6. 기기 언루팅`**
백업해 둔 순정 이미지를 플래싱하여 루팅을 해제하고 순정 상태로 복구합니다.

**`7. 커스텀 리커버리 서명 및 플래싱`**
TWRP와 같은 커스텀 리커버리 이미지를 테스트 키로 서명한 후 리커버리 파티션에 플래싱합니다.

**`0. 설정`**
툴킷 설정을 변경하는 하위 메뉴로 이동합니다 (아래 참조).

### 3.2 설정 메뉴

* **기기 지역 [중국(PRC)/글로벌(ROW)]:** 타겟 펌웨어 지역을 중국 내수용(PRC)과 글로벌(ROW) 중에서 선택합니다.
* **ADB 작업 건너뛰기:** ADB 연결 확인 과정을 건너뜁니다. 기기가 이미 EDL이나 Fastboot 모드일 때 유용합니다.
* **롤백 확인 건너뛰기:** 안티 롤백(Anti-Rollback) 자동 확인 기능을 켜거나 끕니다.
* **언어 변경:** 툴킷의 인터페이스 언어를 변경합니다.
* **업데이트 확인:** LTBox의 최신 버전을 확인합니다.

### 3.3 고급 메뉴

개별 단계를 수동으로 실행하거나 문제를 해결할 때 사용합니다.

**`1. 펌웨어의 지역을 중국(PRC)/글로벌(ROW) 기기용으로 변경`**
설정된 지역에 맞춰 `vendor_boot.img`를 변환하고 `vbmeta.img`를 재빌드합니다.

**`2. 기기에서 devinfo/persist 추출`**
EDL 모드에서 기기의 `devinfo` 및 `persist` 파티션을 추출하여 `backup/` 폴더에 저장합니다.

**`3. 국가 코드 변경을 위해 devinfo/persist 패치`**
`devinfo.img`/`persist.img` 내의 국가 코드(예: "CN", "KR")를 수정합니다.

**`4. 기기에 devinfo/persist 플래싱`**
패치된 이미지를 EDL 모드를 통해 기기에 기록합니다.

**`5. 기기에서 안티 롤백 감지`**
기기의 `boot` 및 `vbmeta_system`을 덤프하여 새 펌웨어와의 롤백 인덱스를 비교합니다.

**`6. ROM 내부 롤백 인덱스 패치`**
롤백 방지를 우회하기 위해 새 펌웨어의 롤백 인덱스를 기기의 인덱스와 동기화합니다.

**`7. 기기에 안티 롤백 우회 패치 이미지 플래싱`**
ARB 패치가 적용된 이미지를 기기에 기록합니다.

**`8. X 파일을 XML로 변환`**
암호화된 `.x` 펌웨어 파일들을 해독하여 `.xml` 파일로 변환합니다.

**`9. 플래싱을 위해 XML 수정 [데이터 초기화]`**
패치된 이미지를 플래싱할 수 있도록 `rawprogram` XML을 생성하며, **데이터를 초기화**하도록 설정합니다.

**`10. 플래싱을 위해 XML 수정 [데이터 유지]`**
9번과 동일하지만, **데이터를 보존**하도록 XML을 수정합니다.

**`11. 기기에 펌웨어 플래싱`**
수동 전체 플래싱을 수행합니다. 패치된 모든 파일을 복사하고 `fh_loader`를 사용하여 플래싱합니다.

**`12. 작업 공간 정리`**
임시 출력 폴더와 파일들을 삭제하여 작업 공간을 정리합니다. 백업 파일은 삭제되지 않습니다.

## 4. 기타 유틸리티

**`info_image.bat`**
`.img` 파일이나 폴더를 이 스크립트 위에 드래그 앤 드롭하면 이미지의 상세 정보를 텍스트 파일로 추출해 줍니다.

## 5. Credits

연구 및 기여해주신 다음 커뮤니티 멤버분들께 특별히 감사드립니다.

* **익명 [ㅇㅇ](https://gall.dcinside.com/board/lists?id=tabletpc)**
* **[갓파더](https://ppomppu.co.kr/zboard/view.php?id=androidtab&page=1&divpage=38&no=197457)**
* **[limzei89](https://note.com/limzei89/n/nd5217eb57827)**
* **[hitin911](https://xdaforums.com/m/hitin911.12861404/)**

---

## License

This work is licensed under a
[Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License][cc-by-nc-sa].

[![CC BY-NC-SA 4.0][cc-by-nc-sa-image]][cc-by-nc-sa]

[cc-by-nc-sa]: http://creativecommons.org/licenses/by-nc-sa/4.0/
[cc-by-nc-sa-image]: https://licensebuttons.net/l/by-nc-sa/4.0/88x31.png
[cc-by-nc-sa-shield]: https://img.shields.io/badge/License-CC%20BY--NC--SA%204.0-lightgrey.svg
